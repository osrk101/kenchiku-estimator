<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- Mapperとxmlのマッピング -->
<mapper
	namespace="com.kenchiku_estimator.repository.AccountMapper">

	<!-- アカウント全取得 -->
	<select id="findAll"
		resultType="com.kenchiku_estimator.model.Account">
		SELECT * FROM accounts
	</select>
	<!-- アカウント氏名全取得 -->
	<select id="findAllFullname"
		resultType="com.kenchiku_estimator.model.Account">
		SELECT id, full_name FROM accounts
	</select>
	<!-- IDでアカウントを取得 -->
	<select id="findById" parameterType="int"
		resultType="com.kenchiku_estimator.model.Account">
		SELECT * FROM accounts WHERE id = #{id}
	</select>
	<!-- ユーザ名でアカウントを取得 -->
	<select id="findByUsername" parameterType="string"
		resultType="com.kenchiku_estimator.model.Account">
		SELECT * FROM accounts WHERE username = #{username}
	</select>
	<!-- 新規登録 -->
	<insert id="insertAccount"
		parameterType="com.kenchiku_estimator.model.Account">
		INSERT INTO accounts (username, password, full_name, role) VALUES
		(#{username}, #{password}, #{fullName}, #{role})
	</insert>
	<!-- 更新 -->
	<update id="updateAccount"
		parameterType="com.kenchiku_estimator.model.Account">
		UPDATE accounts
		<set>
			username = #{username},
			full_name = #{fullName},
			role = #{role},
			<if test="password != null">
				password = #{password},
			</if>
		</set>
		WHERE id = #{id}
	</update>

	<!-- 削除 -->
	<delete id="deleteAccount" parameterType="int">
		DELETE FROM accounts WHERE id = #{id}
	</delete>
	
	<!-- 担当している見積書の数を取得 -->
	<select id="countEstimatesByAccountId" parameterType="int" resultType="int">
        SELECT COUNT(*) FROM estimates WHERE created_by = #{id}
    </select>
</mapper>